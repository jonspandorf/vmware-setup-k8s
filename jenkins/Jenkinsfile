#!/usr/bin/env groovy

pipeline{
    agent any

    parameters
    
    stages{
        stage("Setup Params") {
            steps {
                script {
                    properties([
                        choice(
                            choices: ['ONE', 'TWO'],
                            name: 'PARAM1'
                        ),
                        booleanParam(
                            defaultValue: true ,
                            description:'boolean',
                            name:'BOOL'
                        ),
                        string(
                            defaultValue: 'stringparam',
                            name: 'STRING_PARAM',
                            trim: true
                        )
                    ])
                }
            }
        }
        stage("Prepare for deploy") {
            sh "echo hello!"
        }
        stage("Deploy Clusters") {
            // build_clusters(params.total_num_of_clusters)
            sh "echo deploy"
        }
    }
}

@NonCPS 
def build_clusters(total_num_of_clusters) {
    for (cluster=0; cluster < total_num_of_clusters.size(); cluster++) {
        sh `export CLUSTER_NUM=${cluster}`
        sh `docker-compose -f ./docker/docker-compose.yaml up -d &
    }
}